# ⚙️ 设置指南

## 概述

LLMSider 所有设置和配置选项的完整参考。本指南详细介绍每个设置,包括推荐值和最佳实践。

---

## 📑 目录

- [连接与模型](#连接与模型)
- [向量数据库](#向量数据库)
- [自动补全](#自动补全)
- [快速聊天](#快速聊天)
- [内置工具](#内置工具)
- [MCP 设置](#mcp-设置)
- [UI 设置](#ui-设置)
- [网页搜索](#网页搜索)
- [高级设置](#高级设置)

---

## 🔗 连接与模型

### 连接管理

**位置**: 设置 → LLMSider → 连接与模型

#### 添加连接

1. **点击提供商卡片** 或"添加新连接"
2. **填写必填字段**:
   - **名称**: 友好名称(例如"OpenAI 主要"、"Ollama 本地")
   - **类型**: 基于提供商自动选择
   - **API 密钥**: 您的提供商 API 密钥(如果需要)
   - **基础 URL**: API 端点(有智能默认值)

#### 连接设置

| 设置 | 描述 | 必需 | 默认值 |
|---------|-------------|----------|---------|
| **名称** | 显示名称 | ✅ 是 | - |
| **类型** | 提供商类型 | ✅ 是 | 自动填充 |
| **已启用** | 启用/禁用 | ✅ 是 | true |
| **API 密钥** | 身份验证 | ⚠️ 大多数 | - |
| **基础 URL** | API 端点 | ⚠️ 某些 | 提供商默认 |

#### 提供商特定设置

**OpenAI:**
```yaml
基础 URL: https://api.openai.com/v1
API 密钥: sk-...
```

**Azure OpenAI:**
```yaml
端点: https://<resource>.openai.azure.com
API 密钥: 您的 Azure 密钥
部署名称: your-deployment
API 版本: 2024-02-15-preview
```

**Ollama:**
```yaml
基础 URL: http://localhost:11434
API 密钥: 不需要
```

### 模型配置

**对于每个连接,添加模型:**

#### 模型设置

| 设置 | 描述 | 类型 | 默认值 | 范围 |
|---------|-------------|------|---------|-------|
| **模型名称** | 模型标识符 | 文本 | - | - |
| **显示名称** | 友好名称 | 文本 | - | - |
| **已启用** | 启用/禁用 | 切换 | true | - |
| **温度** | 随机性 | 滑块 | 0.7 | 0.0-2.0 |
| **最大令牌数** | 响应长度 | 数字 | 4096 | 1-128000* |
| **Top P** | 核采样 | 滑块 | 1.0 | 0.0-1.0 |
| **频率惩罚** | 减少重复 | 滑块 | 0.0 | -2.0-2.0 |
| **存在惩罚** | 鼓励新主题 | 滑块 | 0.0 | -2.0-2.0 |

*最大令牌数取决于模型

---

## 🗄️ 向量数据库

**位置**: 设置 → LLMSider → 搜索增强

### 基本设置

#### 启用搜索增强
```yaml
设置: 启用搜索增强
类型: 切换
默认: 关闭
效果: 使用向量嵌入启用本地语义搜索
```

**启用时:**
- 索引整个笔记库
- 启用语义搜索
- 支持上下文检索
- 支持相似笔记

#### 显示相似笔记
```yaml
设置: 显示相似笔记
类型: 切换
默认: 关闭
效果: 在每个笔记底部显示相关笔记
要求: 搜索增强已启用
```

### 嵌入配置

#### 嵌入模型
```yaml
设置: 嵌入模型
类型: 下拉列表
选项: 连接中的所有嵌入模型
必需: 是(如果启用搜索增强)
注意: 仅显示标记为"嵌入模型"的模型
```

**推荐模型:**
- OpenAI: text-embedding-3-small(快速、便宜)
- OpenAI: text-embedding-3-large(高质量)
- 本地: 通过 Ollama 的 Hugging Face 模型

### 分块策略

#### 策略选择
```yaml
设置: 分块策略
类型: 下拉列表
选项:
  - 基于字符(固定大小)
  - 语义(结构感知)
默认: 语义
```

**语义分块**(推荐):
- 按文档结构自动分割
- 保留标题、段落
- 无需配置
- 最适合 Markdown 笔记

**基于字符的分块**:
- 固定大小的块
- 可配置大小和重叠
- 适合统一处理

#### 基于字符策略的参数

**块大小:**
```yaml
设置: 块大小
类型: 数字
默认: 1000
范围: 100-5000
单位: 字符
描述: 每个块的字符数
```

**推荐:**
- 小块(500-800): 更精确,更多向量
- 中块(1000-1500): 平衡
- 大块(2000-5000): 更多上下文,更少向量

**块重叠:**
```yaml
设置: 块重叠
类型: 数字
默认: 100
范围: 0 到(块大小 - 1)
单位: 字符
描述: 块之间重叠的字符数
```

---

## ⚡ 自动补全

**位置**: 设置 → LLMSider → 自动补全

### 基本设置

#### 启用内联补全
```yaml
设置: 启用内联补全
类型: 切换
默认: 关闭
效果: GitHub Copilot 风格的输入建议
```

#### 自动补全模型
```yaml
设置: 模型
类型: 下拉列表
选项: 所有已启用的聊天模型
默认: 无(必须选择)
推荐: 快速模型(GPT-3.5、Claude Haiku)
```

### 触发设置

#### 触发延迟
```yaml
设置: 触发延迟
类型: 数字
默认: 300
单位: 毫秒
范围: 100-5000
描述: 显示建议前的延迟
```

**推荐:**
- 100-200毫秒: 非常响应(可能分散注意力)
- 300-500毫秒: 平衡
- 500-1000毫秒: 保守(较少干扰)

---

## 💬 快速聊天

**位置**: 设置 → LLMSider → 快速聊天

### 设置

#### 启用快速聊天
```yaml
设置: 启用快速聊天
类型: 切换
默认: 开启
效果: 启用 Cmd+/ 内联聊天
```

#### 快速聊天模型
```yaml
设置: 模型
类型: 下拉列表
选项: 所有已启用的聊天模型
默认: 默认聊天模型
```

#### 选中时显示
```yaml
设置: 选中时显示
类型: 切换
默认: 关闭
效果: 选中文本时显示快速聊天按钮
```

#### 显示差异预览
```yaml
设置: 显示差异预览
类型: 切换
默认: 开启
效果: 显示代码/文本更改的可视化差异
```

---

## 🛠️ 内置工具

**位置**: 设置 → LLMSider → 内置工具

### 类别管理

**按类别启用/禁用:**

#### 核心工具(默认: 已启用)
```yaml
✅ 实用工具(10+ 个工具)
✅ 文件系统(15+ 个工具)
✅ 文件管理(20+ 个工具)
✅ 笔记管理(15+ 个工具)
✅ 编辑器(10+ 个工具)
✅ 搜索(15+ 个工具)
✅ 网页内容(10+ 个工具)
✅ 搜索引擎(20+ 个工具)
```

#### 金融数据(默认: 已禁用)
```yaml
❌ 股票市场(150+ 个工具)
❌ 期货(80+ 个工具)
❌ 期权(60+ 个工具)
❌ 债券(50+ 个工具)
❌ 基金(70+ 个工具)
❌ 外汇(30+ 个工具)
❌ 加密货币(15+ 个工具)
❌ 金融(40+ 个工具)
```

---

## 🧠 记忆设置

**位置**: 设置 → LLMSider → 记忆设置

### 工作记忆

#### 启用工作记忆
```yaml
设置: 启用工作记忆
类型: 切换
默认: 开启
效果: 允许 AI 保持当前任务/资源的上下文
```

#### 工作记忆范围
```yaml
设置: 工作记忆范围
类型: 下拉列表
选项:
  - 资源 (全局)
  - 线程 (每个对话)
默认: 资源
效果: 决定记忆是在对话之间共享还是隔离
```

### 对话历史

#### 启用对话历史
```yaml
设置: 启用对话历史
类型: 切换
默认: 开启
效果: 存储过去的消息以提供上下文
```

#### 对话历史限制
```yaml
设置: 对话历史限制
类型: 滑块
默认: 10
范围: 5-1000
描述: 保持在活动上下文中的消息数量
```

### 对话压缩

#### 启用压缩
```yaml
设置: 启用压缩
类型: 切换
默认: 开启
效果: 自动总结旧消息以节省令牌
```

#### 压缩阈值
```yaml
设置: 压缩阈值
类型: 数字
默认: 8000
单位: 令牌
描述: 当对话超过此大小时触发压缩
```

#### 压缩目标
```yaml
设置: 压缩目标
类型: 数字
默认: 4000
单位: 令牌
描述: 压缩后的目标大小
```

#### 保留最近数量
```yaml
设置: 保留最近数量
类型: 数字
默认: 4
描述: 保持未压缩的最近消息数量
```

#### 压缩模型
```yaml
设置: 压缩模型
类型: 下拉列表
选项: 所有已启用的聊天模型
默认: 第一个可用模型
描述: 用于生成摘要的模型
```

---

## 📝 提示词管理

**位置**: 设置 → LLMSider → 提示词管理

### 自定义提示词

管理您的个人提示词库。

- **添加提示词**: 创建新的自定义提示词
- **编辑**: 修改现有提示词
- **删除**: 移除自定义提示词

**提示词字段:**
- **名称**: 显示名称
- **描述**: 提示词的作用
- **内容**: 实际提示词文本(支持占位符)
- **标签**: 用于分类

### 内置提示词

查看和管理系统提供的提示词的可见性。

- **切换可见性**: 隐藏您不使用的内置提示词
- **查看内容**: 查看底层提示词文本

---

## 🔌 MCP 设置

**位置**: 设置 → LLMSider → MCP 设置

### 服务器配置

**通过 JSON 编辑器管理:**

```json
{
  "mcpServers": {
    "server-name": {
      "command": "node",
      "args": ["/path/to/server.js"],
      "env": {
        "API_KEY": "your-key"
      }
    }
  }
}
```

---

## 🎨 UI 设置

**位置**: 设置 → LLMSider → UI 设置

### 语言
```yaml
设置: 语言
类型: 下拉列表
选项:
  - English
  - 简体中文
默认: 系统默认
效果: 更改所有 UI 文本
```

### 默认对话模式
```yaml
设置: 默认对话模式
类型: 下拉列表
选项:
  - 普通(🗣️)
  - 引导(🎯)
  - 代理(🤖)
默认: 普通
效果: 启动新聊天时使用的模式
```

---

## 🌐 网页搜索

**位置**: 设置 → LLMSider → 网页搜索设置

### 搜索后端
```yaml
设置: 搜索后端
类型: 下拉列表
选项:
  - Google 自定义搜索
  - SerpAPI
  - Tavily AI 搜索
默认: 无(必须配置)
```

---

## 🔧 高级设置

**位置**: 设置 → LLMSider → 高级

### 计划执行模式
```yaml
设置: 计划执行模式
类型: 下拉列表
选项:
  - 顺序 (默认)
  - DAG (并行)
效果: 控制代理模式如何执行复杂任务
```
- **顺序**: 步骤按顺序运行(更安全,更易于调试)
- **DAG**: 独立步骤并行运行(复杂任务更快)

### 工具选择限制

#### 最大内置工具选择
```yaml
设置: 最大内置工具选择
类型: 数字
默认: 64
描述: 同时激活的最大内置工具数量
注意: 较高的限制可能会超出模型上下文窗口
```

#### 最大 MCP 工具选择
```yaml
设置: 最大 MCP 工具选择
类型: 数字
默认: 64
描述: 同时激活的最大 MCP 工具数量
```

### 调试模式
```yaml
设置: 调试模式
类型: 切换
默认: 关闭
效果: 在控制台中启用详细日志记录
用途: 故障排除、开发
```

**启用时:**
- 记录所有 API 调用
- 工具执行详情
- 性能指标
- 错误堆栈跟踪

### 请求超时
```yaml
设置: 请求超时
类型: 数字
默认: 60000
单位: 毫秒
范围: 5000-300000
描述: API 请求超时
```

---

## 💡 推荐配置

### 初学者

```yaml
连接:
  - OpenAI (GPT-3.5 Turbo) 或
  - Ollama (Llama 3 - 本地、免费)

设置:
  - 自动补全: 关闭(先学习基础)
  - 快速聊天: 开启
  - 向量数据库: 关闭(稍后设置)
  - 内置工具: 仅核心
  - 对话模式: 普通
```

### 高级用户

```yaml
连接:
  - OpenAI (GPT-4 Turbo, GPT-3.5)
  - Anthropic (Claude 3.5 Sonnet)
  - Ollama (本地备份)

设置:
  - 自动补全: 开启(GPT-3.5)
  - 快速聊天: 开启(GPT-4)
  - 向量数据库: 开启(text-embedding-3-small)
  - 内置工具: 核心 + 所需类别
  - 对话模式: 引导
```

### 开发者

```yaml
连接:
  - GitHub Copilot
  - Anthropic Claude 3.5
  - Ollama (各种模型)

设置:
  - 自动补全: 开启(GitHub Copilot)
  - 快速聊天: 开启(Claude)
  - 向量数据库: 开启
  - 内置工具: 所有核心工具
  - 对话模式: 代理
  - 调试模式: 开启
```

---

## 🐛 故障排除

### 设置未保存
```
✅ 检查文件权限
✅ 重新加载 Obsidian
✅ 检查控制台错误
✅ 备份并重置设置
```

### 模型未出现
```
✅ 验证连接已启用
✅ 检查 API 密钥有效
✅ 手动测试连接
✅ 重新加载提供商
```

---

## 📚 相关指南

- [连接与模型](connections-and-models.md) - 详细提供商设置
- [搜索增强](search-enhancement.md) - 语义搜索指南
- [内置工具](built-in-tools.md) - 完整工具参考
- [MCP 集成](mcp-integration.md) - 外部工具设置

---

**有疑问?** [GitHub Issues](https://github.com/gnuhpc/obsidian-llmsider/issues)
